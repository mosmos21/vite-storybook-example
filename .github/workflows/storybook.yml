name: Build and Deploy
on: push
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: output encoded branch name ðŸŒ²
        id: branch-name
        uses: actions/github-script@v6
        with:
          script: return encodeURIComponent(context.ref.replace('refs/heads/', ''))
          result-encoding: string
      - name: build storybook ðŸ”§
        run: npm i && npm run build-storybook
        env:
          STORYBOOK_BASE_DIR: /vite-storybook-example/${{ steps.branch-name.outputs.result }}/
      - uses: actions/checkout@v3
        with:
          ref: storybook
      - name: deploy storybook branch ðŸš€
        run: |
          echo $TARGET_DIR
          mv storybook-static $TARGET_DIR
          git add $TARGET_DIR
          if [ $(git status --short | wc -l) -ne 0 ]; then echo test; fi
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TARGET_DIR: ${{ steps.branch-name.outputs.result }}
